overlay: 1.0.0
info:
  title: Clustered Management API overlay
  version: 1.0.0
actions:
  - target: $.info
    update:
      title: InfluxDB 3 Clustered Management API
      description: |
        The Management API for InfluxDB 3 Clustered provides a programmatic interface for managing an InfluxDB 3 cluster.
        The Management API lets you integrate functions such as creating and managing databases, permissions, and tokens into your workflow or application.

        This documentation is generated from the
        InfluxDB 3 Management API OpenAPI specification.
      version: ''
      license:
        name: MIT
        url: https://opensource.org/licenses/MIT
      contact:
        name: InfluxData
        url: https://www.influxdata.com
        email: support@influxdata.com
  - target: $.servers
    update:
      - url: https://{baseurl}/api/v0
        description: InfluxDB 3 Clustered Management API URL
        variables:
          baseurl:
            enum:
              - console.influxdata.com
            default: console.influxdata.com
            description: InfluxDB 3 Clustered Console URL
  - target: $.tags
    update:
      - name: Authentication
        x-traitTag: true
        description: |
          With InfluxDB 3 Clustered, InfluxDB Management API endpoints require the following credential:

          - `Authorization MANAGEMENT_TOKEN`: the `Authorization` HTTP header with a [management token](/influxdb3/clustered/admin/tokens/management/).

            See how to [create a management token](/influxdb3/clustered/admin/tokens/management/).

            By default, management tokens in InfluxDB 3 are short-lived tokens issued by an OAuth2 identity provider that grant a specific user administrative access to your InfluxDB cluster. However, for automation purposes, you can manually create management tokens that authenticate directly with your InfluxDB cluster and do not require human interaction with your identity provider.
      - name: Database tokens
        description: Manage database read/write tokens for a cluster
      - name: Databases
        description: Manage databases for a cluster
      - name: Quickstart
        x-traitTag: true
        description: |
          The following example script shows how to use `curl` to make database and token management requests:

          ```shell
           #!/bin/bash

           # Usage:
           # Note the leading space in the command below to keep secrets out of the shell history
           #
           # ```
           #  MANAGEMENT_TOKEN=<MANAGEMENT_TOKEN> ./scripts/test_http_api_v0_endpoints.sh
           # ```

           # Env var validation
           if [ -z "${MANAGEMENT_TOKEN}" ]; then
             echo "
           [Error]: ‚ùå
             \$MANAGEMENT_TOKEN env var is required.
               "
               exit 1
           fi

          HOST="https://cluster-host.com"

           # Database request functions
           list_databases () {
             local response=$( \
               curl \
                 --location "$HOST/api/v0/databases" \
                 --header "Accept: application/json" \
                 --header "Authorization: Bearer $MANAGEMENT_TOKEN" \
             )
             echo "$response"
           }

           create_database () {
             local databaseName=$1
             local response=$( \
               curl \
                 --location "$HOST/api/v0/databases" \
                 --header "Accept: application/json" \
                 --header 'Content-Type: application/json' \
                 --header "Authorization: Bearer $MANAGEMENT_TOKEN" \
                 --data '{
                   "name": "'$databaseName'",
                   "maxTables": 75,
                   "maxColumnsPerTable": 90,
                   "retentionPeriod": 600000000000,
                   "partitionTemplate": [
                     {
                       "type": "tag",
                       "value": "abc"
                     },
                     {
                       "type": "bucket",
                       "value": {
                         "tagName": "def",
                         "numberOfBuckets": 5
                       }
                     }
                   ]
                 }' \
             )
             echo "$response"
           }

           update_database () {
             local databaseName=$1
             local response=$( \
               curl \
                 --location "$HOST/api/v0/databases/$databaseName" \
                 --request PATCH \
                 --header "Accept: application/json" \
                 --header 'Content-Type: application/json' \
                 --header "Authorization: Bearer $MANAGEMENT_TOKEN" \
                 --data '{
                   "maxTables": 150,
                   "maxColumnsPerTable": 180,
                   "retentionPeriod": 1200000000000
                 }' \
             )
             echo "$response"
           }

           delete_database () {
             local databaseName=$1
             local response=$( \
               curl \
                 --location "$HOST/api/v0/databases/$databaseName" \
                 --request DELETE \
                 --header "Accept: application/json" \
                 --header "Authorization: Bearer $MANAGEMENT_TOKEN" \
             )
             echo "$response"
           }

           # Token request functions
           list_tokens () {
             local response=$( \
               curl \
                 --location "$HOST/api/v0/tokens" \
                 --header "Accept: application/json" \
                 --header "Authorization: Bearer $MANAGEMENT_TOKEN" \
             )
             echo "$response"
           }

           create_token () {
             local response=$( \
               curl \
                 --location "$HOST/api/v0/tokens" \
                 --header "Accept: application/json" \
                 --header 'Content-Type: application/json' \
                 --header "Authorization: Bearer $MANAGEMENT_TOKEN" \
                 --data '{
                   "description": "my test token",
                   "permissions": [
                     {
                       "action": "write",
                       "resource": "database_one"
                     },
                     {
                       "action": "read",
                       "resource": "database_two"
                     }
                   ]
                 }' \
             )
             echo "$response"
           }

           get_token () {
             local token_id=$1
             local response=$( \
               curl \
                 --location "$HOST/api/v0/tokens/$tokenId" \
                 --header "Accept: application/json" \
                 --header "Authorization: Bearer $MANAGEMENT_TOKEN" \
             )
             echo "$response"
           }

           update_token () {
             local token_id=$1
             local response=$( \
               curl \
                 --location "$HOST/api/v0/tokens/$tokenId" \
                 --request PATCH \
                 --header "Accept: application/json" \
                 --header 'Content-Type: application/json' \
                 --header "Authorization: Bearer $MANAGEMENT_TOKEN" \
                 --data '{
                   "description": "my updated test token",
                   "permissions": [
                     {
                       "action": "database_one",
                       "resource": "read"
                     }
                   ]
                 }' \
             )
             echo "$response"
           }

           delete_token () {
             local token_id=$1
             local response=$( \
               curl \
                 --location "$HOST/api/v0/tokens/$tokenId" \
                 --request DELETE \
                 --header "Accept: application/json" \
                 --header "Authorization: Bearer $MANAGEMENT_TOKEN" \
             )
             echo "$response"
           }


           # Test database endpoints
           databaseName="test_database_$RANDOM"

           printf "\nüèóÔ∏è   Creating database...  üèóÔ∏è\n\n"
           response="$(create_database $databaseName)"
           echo $response | jq
           printf "\nüèóÔ∏è   Creating database successful  üèóÔ∏è\n\n"

           printf "\n‚¨ÜÔ∏è   Updating database...  ‚¨ÜÔ∏è\n\n"
           response="$(update_database $databaseName)"
           echo $response | jq
           printf "\n‚¨ÜÔ∏è   Updating database successful  ‚¨ÜÔ∏è\n\n"

           printf "\n‚¨áÔ∏è   Listing databases...  ‚¨áÔ∏è\n\n"
           response="$(list_databases)"
           echo $response | jq
           printf "\n‚¨áÔ∏è   Listing databases successful  ‚¨áÔ∏è\n\n"

           printf "\nüóëÔ∏è   Deleting database...  üóëÔ∏è\n\n"
           response="$(delete_database $databaseName)"
           echo $response | jq
           printf "\nüóëÔ∏è   Deleting database successful  üóëÔ∏è\n\n"


           # Test token endpoints
           printf "\nüèóÔ∏è   Creating token...  üèóÔ∏è\n\n"
           response="$(create_token)"
           echo $response | jq
           tokenId=$(echo $response | jq '.id')
           printf "\nüèóÔ∏è   Creating token successful  üèóÔ∏è\n\n"

           printf "\n‚¨áÔ∏è   Getting token...  ‚¨áÔ∏è\n\n"
           response="$(get_token $tokenId)"
           echo $response | jq
           printf "\n‚¨áÔ∏è   Getting token successful  ‚¨áÔ∏è\n\n"

           printf "\n‚¨ÜÔ∏è   Updating token...  ‚¨ÜÔ∏è\n\n"
           response="$(update_token $tokenId)"
           echo $response | jq
           printf "\n‚¨ÜÔ∏è   Updating token successful  ‚¨ÜÔ∏è\n\n"

           printf "\nüìã   Listing tokens...  üìã\n\n"
           response="$(list_tokens)"
           echo $response | jq
           printf "\nüìã   Listing tokens successful  üìã\n\n"

           printf "\nüóëÔ∏è   Deleting token...  üóëÔ∏è\n\n"
           response="$(delete_token $tokenId)"
           echo $response | jq
           printf "\nüóëÔ∏è   Deleting token successful  üóëÔ∏è\n\n"
               ```
      - name: Tables
        description: Manage tables in a database
  - target: $.paths['/databases']
    update:
      get:
        operationId: GetClusterDatabases
        summary: Get all databases for a cluster
        responses:
          '200':
            description: The cluster databases were successfully retrieved
            content:
              application/json:
                schema:
                  type: array
                  items:
                    type: object
                    properties:
                      name:
                        $ref: '#/components/schemas/ClusterDatabaseName'
                      maxTables:
                        $ref: '#/components/schemas/ClusterDatabaseMaxTables'
                      maxColumnsPerTable:
                        $ref: '#/components/schemas/ClusterDatabaseMaxColumnsPerTable'
                      retentionPeriod:
                        $ref: '#/components/schemas/ClusterDatabaseRetentionPeriod'
                      partitionTemplate:
                        $ref: '#/components/schemas/ClusterDatabasePartitionTemplate'
                    required:
                      - name
                      - maxTables
                      - maxColumnsPerTable
                      - retentionPeriod
                example:
                  - name: DatabaseOne
                    maxTables: 500
                    maxColumnsPerTable: 200
                    retentionPeriod: 0
                  - name: DatabaseTwo
                    maxTables: 100
                    maxColumnsPerTable: 50
                    retentionPeriod: 300000000000
                    partitionTemplate:
                      - type: time
                        value: '%Y'
                      - type: tag
                        value: bananas
                      - type: tag
                        value: pl√°tanos
                      - type: bucket
                        value:
                          tagName: c
                          numberOfBuckets: 10
          '400':
            $ref: '#/components/responses/BadRequest'
          '401':
            $ref: '#/components/responses/Unauthorized'
          '403':
            $ref: '#/components/responses/Forbidden'
          '404':
            $ref: '#/components/responses/NotFound'
          '500':
            $ref: '#/components/responses/InternalServerError'
        x-codeSamples:
          - label: ''
            lang: Shell
            source: |
              HOST="https://cluster-host.com"

              list_databases () {
                local response=$( \
                  curl \
                    --location "$HOST/api/v0/databases" \
                    --header "Accept: application/json" \
                    --header "Authorization: Bearer $MANAGEMENT_TOKEN" \
                )
                echo "$response"
              }
        tags:
          - Databases
      post:
        operationId: CreateClusterDatabase
        summary: Create a database
        tags:
          - Databases
        requestBody:
          required: true
          content:
            application/json:
              schema:
                type: object
                properties:
                  name:
                    $ref: '#/components/schemas/ClusterDatabaseName'
                  maxTables:
                    $ref: '#/components/schemas/ClusterDatabaseMaxTables'
                  maxColumnsPerTable:
                    $ref: '#/components/schemas/ClusterDatabaseMaxColumnsPerTable'
                  retentionPeriod:
                    $ref: '#/components/schemas/ClusterDatabaseRetentionPeriod'
                  partitionTemplate:
                    $ref: '#/components/schemas/ClusterDatabasePartitionTemplate'
                required:
                  - name
              examples:
                requiredFieldsOnly:
                  summary: Required Fields Only
                  value:
                    name: DatabaseOne
                allFields:
                  summary: All Fields
                  value:
                    name: DatabaseTwo
                    maxTables: 100
                    maxColumnsPerTable: 50
                    retentionPeriod: 300000000000
                    partitionTemplate:
                      - type: time
                        value: '%Y'
                      - type: tag
                        value: bananas
                      - type: tag
                        value: pl√°tanos
                      - type: bucket
                        value:
                          tagName: c
                          numberOfBuckets: 10
        responses:
          '200':
            description: The cluster database was successfully created
            content:
              application/json:
                schema:
                  type: object
                  properties:
                    name:
                      $ref: '#/components/schemas/ClusterDatabaseName'
                    maxTables:
                      $ref: '#/components/schemas/ClusterDatabaseMaxTables'
                    maxColumnsPerTable:
                      $ref: '#/components/schemas/ClusterDatabaseMaxColumnsPerTable'
                    retentionPeriod:
                      $ref: '#/components/schemas/ClusterDatabaseRetentionPeriod'
                    partitionTemplate:
                      $ref: '#/components/schemas/ClusterDatabasePartitionTemplate'
                  required:
                    - name
                    - maxTables
                    - maxColumnsPerTable
                    - retentionPeriod
                examples:
                  requiredFieldsOnly:
                    summary: Required Fields Only
                    value:
                      name: DatabaseOne
                      maxTables: 500
                      maxColumnsPerTable: 200
                      retentionPeriod: 0
                  allFields:
                    summary: All Fields
                    value:
                      name: DatabaseTwo
                      maxTables: 100
                      maxColumnsPerTable: 50
                      retentionPeriod: 300000000000
                      partitionTemplate:
                        - type: time
                          value: '%Y'
                        - type: tag
                          value: a
                        - type: tag
                          value: c
                        - type: bucket
                          value:
                            tagName: c
                            numberOfBuckets: 10
          '400':
            $ref: '#/components/responses/BadRequest'
          '401':
            $ref: '#/components/responses/Unauthorized'
          '403':
            $ref: '#/components/responses/Forbidden'
          '404':
            $ref: '#/components/responses/NotFound'
          '409':
            $ref: '#/components/responses/Conflict'
          '500':
            $ref: '#/components/responses/InternalServerError'
        x-codeSamples:
          - label: cURL
            lang: Shell
            source: |
              HOST="https://cluster-host.com"

              create_database () {
                local databaseName=$1
                local response=$( \
                  curl \
                    --location "$HOST/api/v0/databases" \
                    --header "Accept: application/json" \
                    --header 'Content-Type: application/json' \
                    --header "Authorization: Bearer $MANAGEMENT_TOKEN" \
                    --data '{
                      "name": "'$databaseName'",
                      "maxTables": 75,
                      "maxColumnsPerTable": 90,
                      "retentionPeriod": 600000000000,
                      "partitionTemplate": [
                        {
                          "type": "tag",
                          "value": "abc"
                        },
                        {
                          "type": "bucket",
                          "value": {
                            "tagName": "def",
                            "numberOfBuckets": 5
                          }
                        }
                      ]
                    }' \
                )
                echo "$response"
              }
  - target: $.paths['/databases/{databaseName}']
    update:
      patch:
        operationId: UpdateClusterDatabase
        summary: Update a database
        tags:
          - Databases
        parameters:
          - name: databaseName
            in: path
            description: The name of the database to update
            required: true
            schema:
              $ref: '#/components/schemas/ClusterDatabaseName'
        requestBody:
          required: true
          content:
            application/json:
              schema:
                type: object
                properties:
                  maxTables:
                    $ref: '#/components/schemas/ClusterDatabaseMaxTables'
                  maxColumnsPerTable:
                    $ref: '#/components/schemas/ClusterDatabaseMaxColumnsPerTable'
                  retentionPeriod:
                    $ref: '#/components/schemas/ClusterDatabaseRetentionPeriod'
                minProperties: 1
              examples:
                allFields:
                  summary: Update All Fields
                  value:
                    maxTables: 300
                    maxColumnsPerTable: 150
                    retentionPeriod: 600000000000
                maxTablesOnly:
                  summary: Update Max Tables Only
                  value:
                    maxTables: 300
                maxColumnsPerTableOnly:
                  summary: Update Max Columns Per Table Only
                  value:
                    maxColumnsPerTable: 150
                retentionPeriodOnly:
                  summary: Update Retention Period Only
                  value:
                    retentionPeriod: 600000000000
        responses:
          '200':
            description: The cluster database was successfully updated.
            content:
              application/json:
                schema:
                  type: object
                  properties:
                    name:
                      $ref: '#/components/schemas/ClusterDatabaseName'
                    maxTables:
                      $ref: '#/components/schemas/ClusterDatabaseMaxTables'
                    maxColumnsPerTable:
                      $ref: '#/components/schemas/ClusterDatabaseMaxColumnsPerTable'
                    retentionPeriod:
                      $ref: '#/components/schemas/ClusterDatabaseRetentionPeriod'
                  required:
                    - maxTables
                    - maxColumnsPerTable
                    - retentionPeriod
                    - name
                examples:
                  allFields:
                    summary: Update All Fields
                    value:
                      name: DatabaseOne
                      maxTables: 300
                      maxColumnsPerTable: 150
                      retentionPeriod: 600000000000
                  maxTablesOnly:
                    summary: Update Max Tables Only
                    value:
                      name: DatabaseOne
                      maxTables: 300
                      maxColumnsPerTable: 200
                      retentionPeriod: 0
                  maxColumnsPerTableOnly:
                    summary: Update Max Columns Per Table Only
                    value:
                      name: DatabaseOne
                      maxTables: 500
                      maxColumnsPerTable: 150
                      retentionPeriod: 0
                  retentionPeriodOnly:
                    summary: Update Retention Period Only
                    value:
                      name: DatabaseOne
                      maxTables: 500
                      maxColumnsPerTable: 200
                      retentionPeriod: 600000000000
          '400':
            $ref: '#/components/responses/BadRequest'
          '401':
            $ref: '#/components/responses/Unauthorized'
          '403':
            $ref: '#/components/responses/Forbidden'
          '404':
            $ref: '#/components/responses/NotFound'
          '500':
            $ref: '#/components/responses/InternalServerError'
        x-codeSamples:
          - label: cURL
            lang: Shell
            source: |
              HOST="https://cluster-host.com"

              update_database () {
                local databaseName=$1
                local response=$( \
                  curl \
                    --location "$HOST/api/v0/databases/$databaseName" \
                    --request PATCH \
                    --header "Accept: application/json" \
                    --header 'Content-Type: application/json' \
                    --header "Authorization: Bearer $MANAGEMENT_TOKEN" \
                    --data '{
                      "maxTables": 150,
                      "maxColumnsPerTable": 180,
                      "retentionPeriod": 1200000000000
                    }' \
                )
                echo "$response"
              }
      delete:
        operationId: DeleteClusterDatabase
        summary: Delete a database
        tags:
          - Databases
        parameters:
          - name: databaseName
            in: path
            description: The name of the database to delete
            required: true
            schema:
              $ref: '#/components/schemas/ClusterDatabaseName'
        responses:
          '204':
            description: The cluster database was successfully deleted
            $ref: '#/components/responses/NoContent'
          '400':
            $ref: '#/components/responses/BadRequest'
          '401':
            $ref: '#/components/responses/Unauthorized'
          '403':
            $ref: '#/components/responses/Forbidden'
          '404':
            $ref: '#/components/responses/NotFound'
          '500':
            $ref: '#/components/responses/InternalServerError'
        x-codeSamples:
          - label: cURL
            lang: Shell
            source: |
              HOST="https://cluster-host.com"

              delete_database () {
                local databaseName=$1
                local response=$( \
                  curl \
                    --location "$HOST/api/v0/databases/$databaseName" \
                    --request DELETE \
                    --header "Accept: application/json" \
                    --header "Authorization: Bearer $MANAGEMENT_TOKEN" \
                )
                echo "$response"
              }
  - target: $.paths['/databases/{databaseName}/tables']
    update:
      post:
        operationId: CreateClusterDatabaseTable
        summary: Create a database table
        tags:
          - Tables
        parameters:
          - name: databaseName
            in: path
            description: The name of the database to create the database table for
            required: true
            schema:
              $ref: '#/components/schemas/ClusterDatabaseName'
        requestBody:
          required: true
          content:
            application/json:
              schema:
                type: object
                properties:
                  name:
                    $ref: '#/components/schemas/ClusterDatabaseTableName'
                  partitionTemplate:
                    $ref: '#/components/schemas/ClusterDatabasePartitionTemplate'
                required:
                  - name
              examples:
                requiredFieldsOnly:
                  summary: Required Fields Only
                  value:
                    name: TableOne
                allFields:
                  summary: All Fields
                  value:
                    name: TableTwo
                    partitionTemplate:
                      - type: time
                        value: '%Y'
                      - type: tag
                        value: bananas
                      - type: tag
                        value: pl√°tanos
                      - type: bucket
                        value:
                          tagName: c
                          numberOfBuckets: 10
        responses:
          '200':
            description: The cluster database table was successfully created
            content:
              application/json:
                schema:
                  type: object
                  properties:
                    databaseName:
                      description: The name of the database that the database table belongs to
                      $ref: '#/components/schemas/ClusterDatabaseName'
                    name:
                      description: The name of the database table
                      $ref: '#/components/schemas/ClusterDatabaseTableName'
                    partitionTemplate:
                      $ref: '#/components/schemas/ClusterDatabasePartitionTemplate'
                  required:
                    - databaseName
                    - name
                examples:
                  requiredFieldsOnly:
                    summary: Required Fields Only
                    value:
                      databaseName: DatabaseOne
                      name: TableOne
                  allFields:
                    summary: All Fields
                    value:
                      databaseName: DatabaseOne
                      name: TableTwo
                      partitionTemplate:
                        - type: time
                          value: '%Y'
                        - type: tag
                          value: a
                        - type: tag
                          value: c
                        - type: bucket
                          value:
                            tagName: c
                            numberOfBuckets: 10
          '400':
            $ref: '#/components/responses/BadRequest'
          '401':
            $ref: '#/components/responses/Unauthorized'
          '403':
            $ref: '#/components/responses/Forbidden'
          '404':
            $ref: '#/components/responses/NotFound'
          '409':
            $ref: '#/components/responses/Conflict'
          '500':
            $ref: '#/components/responses/InternalServerError'
  - target: $.paths['/tokens']
    update:
      get:
        operationId: GetDatabaseTokens
        summary: Get all database tokens for a cluster
        tags:
          - Database tokens
        responses:
          '200':
            description: The database tokens were successfully retrieved
            content:
              application/json:
                schema:
                  type: array
                  items:
                    type: object
                    properties:
                      id:
                        description: The ID of the database token
                        $ref: '#/components/schemas/UuidV4'
                      description:
                        $ref: '#/components/schemas/DatabaseTokenDescription'
                      permissions:
                        $ref: '#/components/schemas/DatabaseTokenPermissions'
                      createdAt:
                        $ref: '#/components/schemas/DatabaseTokenCreatedAt'
                      expiresAt:
                        $ref: '#/components/schemas/DatabaseTokenExpiresAt'
                      revokedAt:
                        $ref: '#/components/schemas/DatabaseTokenRevokedAt'
                    required:
                      - id
                      - description
                      - permissions
                      - createdAt
                example:
                  - id: 55555555-5555-4555-8555-555555555555
                    description: Limited Access Token
                    permissions:
                      - action: read
                        resource: DatabaseOne
                      - action: write
                        resource: DatabaseTwo
                    createdAt: '2023-12-21T17:32:28.000Z'
                  - id: 66666666-6666-4666-8666-666666666666
                    description: Full Access Token
                    permissions:
                      - action: write
                        resource: '*'
                    createdAt: '2024-03-02T04:20:19.000Z'
                  - id: 77777777-7777-4777-8777-777777777777
                    description: No Access Token
                    permissions: []
                    createdAt: '2024-03-02T04:20:19.000Z'
          '400':
            $ref: '#/components/responses/BadRequest'
          '401':
            $ref: '#/components/responses/Unauthorized'
          '403':
            $ref: '#/components/responses/Forbidden'
          '404':
            $ref: '#/components/responses/NotFound'
          '500':
            $ref: '#/components/responses/InternalServerError'
        x-codeSamples:
          - label: cURL
            lang: Shell
            source: |
              HOST="https://cluster-host.com"

              list_tokens () {
                local response=$( \
                  curl \
                    --location "$HOST/api/v0/tokens" \
                    --header "Accept: application/json" \
                    --header "Authorization: Bearer $MANAGEMENT_TOKEN" \
                )
                echo "$response"
              }
      post:
        operationId: CreateDatabaseToken
        summary: Create a database token
        tags:
          - Database tokens
        description: |
          Create a [database token](/influxdb3/clustered/admin/tokens/database/) for a cluster.

          The token returned on the `accessToken` property in the response can be used to authenticate query and write requests to the cluster.

          ### Notable behaviors

          - InfluxDB might take some time--from a few seconds to a few minutes--to activate and synchronize new tokens. If a new database token doesn't immediately work (you receive a `401 Unauthorized` error) for querying or writing, wait and then try your request again.

          - Token strings are viewable _only_ on token creation and aren't stored by InfluxDB; you can't recover a lost token.

          #### Store secure tokens in a secret store

          We recommend storing database tokens in a **secure secret store**.
          For example, see how to [authenticate Telegraf using tokens in your OS secret store](https://github.com/influxdata/telegraf/tree/master/plugins/secretstores/os).

          If you lose a token, [delete the token from InfluxDB](/influxdb3/clustered/admin/tokens/database/delete/) and create a new one.
        requestBody:
          required: true
          content:
            application/json:
              schema:
                type: object
                properties:
                  description:
                    $ref: '#/components/schemas/DatabaseTokenDescription'
                  permissions:
                    $ref: '#/components/schemas/DatabaseTokenPermissions'
                  expiresAt:
                    $ref: '#/components/schemas/DatabaseTokenExpiresAt'
                required:
                  - description
              examples:
                limitedAccessToken:
                  summary: Limited Access Token
                  value:
                    description: Limited Access Token
                    permissions:
                      - action: read
                        resource: DatabaseOne
                      - action: write
                        resource: DatabaseTwo
                fullAccessToken:
                  summary: Full Access Token
                  value:
                    description: Full Access Token
                    permissions:
                      - action: write
                        resource: '*'
                noAccessToken:
                  summary: No Access Token
                  value:
                    description: No Access Token
                    permissions: []
        responses:
          '200':
            description: The database token was successfully created
            content:
              application/json:
                schema:
                  type: object
                  properties:
                    id:
                      description: The ID of the database token
                      $ref: '#/components/schemas/UuidV4'
                    description:
                      $ref: '#/components/schemas/DatabaseTokenDescription'
                    permissions:
                      $ref: '#/components/schemas/DatabaseTokenPermissions'
                    createdAt:
                      $ref: '#/components/schemas/DatabaseTokenCreatedAt'
                    accessToken:
                      $ref: '#/components/schemas/DatabaseTokenAccessToken'
                    expiresAt:
                      $ref: '#/components/schemas/DatabaseTokenExpiresAt'
                    revokedAt:
                      $ref: '#/components/schemas/DatabaseTokenRevokedAt'
                  required:
                    - id
                    - description
                    - permissions
                    - createdAt
                    - accessToken
                examples:
                  limitedAccessToken:
                    summary: Limited Access Token
                    value:
                      id: 55555555-5555-4555-8555-555555555555
                      description: Limited Access Token
                      permissions:
                        - action: read
                          resource: DatabaseOne
                        - action: write
                          resource: DatabaseTwo
                      createdAt: '2023-12-21T17:32:28.000Z'
                      accessToken: apiv1_5555555555555555555555555555555555555555555555555555555555555555
                  fullAccessToken:
                    summary: Full Access Token
                    value:
                      id: 66666666-6666-4666-8666-666666666666
                      description: Full Access Token
                      permissions:
                        - action: write
                          resource: '*'
                      createdAt: '2024-03-02T04:20:19.000Z'
                      accessToken: apiv1_6666666666666666666666666666666666666666666666666666666666666666
                  noAccessToken:
                    summary: No Access Token
                    value:
                      id: 66666666-6666-4666-8666-666666666666
                      description: No Access Token
                      permissions: []
                      createdAt: '2024-03-02T04:20:19.000Z'
                      accessToken: apiv1_7777777777777777777777777777777777777777777777777777777777777777
          '400':
            $ref: '#/components/responses/BadRequest'
          '401':
            $ref: '#/components/responses/Unauthorized'
          '403':
            $ref: '#/components/responses/Forbidden'
          '404':
            $ref: '#/components/responses/NotFound'
          '409':
            $ref: '#/components/responses/Conflict'
          '500':
            $ref: '#/components/responses/InternalServerError'
        x-codeSamples:
          - label: cURL
            lang: Shell
            source: |
              HOST="https://cluster-host.com"

              create_token () {
                local description=$1
                local response=$( \
                  curl \
                    --location "$HOST/api/v0/tokens" \
                    --header "Accept: application/json" \
                    --header 'Content-Type: application/json' \
                    --header "Authorization: Bearer $MANAGEMENT_TOKEN" \
                    --data '{
                      "description": "'$description'",
                      "permissions": [
                        {
                          "action": "read",
                          "resource": "DatabaseOne"
                        },
                        {
                          "action": "write",
                          "resource": "DatabaseTwo"
                        }
                      ]
                    }' \
                )
                echo "$response"
              }
  - target: $.paths['/tokens/{tokenId}']
    update:
      get:
        operationId: GetDatabaseToken
        summary: Get a database token
        tags:
          - Database tokens
        parameters:
          - name: tokenId
            in: path
            description: The ID of the [database token](/influxdb3/clustered/admin/tokens/database/) to get
            required: true
            schema:
              $ref: '#/components/schemas/UuidV4'
        responses:
          '200':
            description: The database token was successfully retrieved.
            content:
              application/json:
                schema:
                  type: object
                  properties:
                    id:
                      description: The ID of the database token
                      $ref: '#/components/schemas/UuidV4'
                    description:
                      $ref: '#/components/schemas/DatabaseTokenDescription'
                    permissions:
                      $ref: '#/components/schemas/DatabaseTokenPermissions'
                    createdAt:
                      $ref: '#/components/schemas/DatabaseTokenCreatedAt'
                    expiresAt:
                      $ref: '#/components/schemas/DatabaseTokenExpiresAt'
                    revokedAt:
                      $ref: '#/components/schemas/DatabaseTokenRevokedAt'
                  required:
                    - id
                    - description
                    - permissions
                    - createdAt
                examples:
                  limitedAccessToken:
                    summary: Limited Access Token
                    value:
                      id: 55555555-5555-4555-8555-555555555555
                      description: Limited Access Token
                      permissions:
                        - action: read
                          resource: DatabaseOne
                        - action: write
                          resource: DatabaseTwo
                      createdAt: '2023-12-21T17:32:28.000Z'
                  fullAccessToken:
                    summary: Full Access Token
                    value:
                      id: 66666666-6666-4666-8666-666666666666
                      description: Full Access Token
                      permissions:
                        - action: write
                          resource: '*'
                      createdAt: '2024-03-02T04:20:19.000Z'
                  noAccessToken:
                    summary: No Access Token
                    value:
                      id: 77777777-7777-4777-8777-777777777777
                      description: No Access Token
                      permissions: []
                      createdAt: '2024-03-02T04:20:19.000Z'
          '400':
            $ref: '#/components/responses/BadRequest'
          '401':
            $ref: '#/components/responses/Unauthorized'
          '403':
            $ref: '#/components/responses/Forbidden'
          '404':
            $ref: '#/components/responses/NotFound'
          '500':
            $ref: '#/components/responses/InternalServerError'
        x-codeSamples:
          - label: cURL
            lang: Shell
            source: |
              HOST="https://cluster-host.com"

              get_token () {
                local tokenId=$1
                local response=$( \
                  curl \
                    --location "$HOST/api/v0/tokens/$tokenId" \
                    --header "Accept: application/json" \
                    --header "Authorization: Bearer $MANAGEMENT_TOKEN" \
                )
                echo "$response"
              }
      patch:
        operationId: UpdateDatabaseToken
        summary: Update a database token
        tags:
          - Database tokens
        parameters:
          - name: tokenId
            in: path
            description: The ID of the [database token](/influxdb3/clustered/admin/tokens/database/) to update
            required: true
            schema:
              $ref: '#/components/schemas/UuidV4'
        requestBody:
          required: true
          content:
            application/json:
              schema:
                type: object
                properties:
                  description:
                    $ref: '#/components/schemas/DatabaseTokenDescription'
                  permissions:
                    $ref: '#/components/schemas/DatabaseTokenPermissions'
                minProperties: 1
              examples:
                allFields:
                  summary: Update All Fields
                  value:
                    description: Updated Limited Access Token
                    permissions:
                      - action: write
                        resource: DatabaseOne
                      - action: read
                        resource: DatabaseTwo
                      - action: write
                        resource: DatabaseThree
                descriptionOnly:
                  summary: Update Description Only
                  value:
                    description: Updated Limited Access Token
                permissionsOnly:
                  summary: Update Permissions Only
                  value:
                    permissions:
                      - action: write
                        resource: DatabaseOne
                      - action: read
                        resource: DatabaseTwo
                      - action: write
                        resource: DatabaseThree
                removeAllPermissions:
                  summary: Remove All Permissions
                  value:
                    permissions: []
        responses:
          '200':
            description: The database token was successfully updated
            content:
              application/json:
                schema:
                  type: object
                  properties:
                    id:
                      description: The ID of the database token
                      $ref: '#/components/schemas/UuidV4'
                    description:
                      $ref: '#/components/schemas/DatabaseTokenDescription'
                    permissions:
                      $ref: '#/components/schemas/DatabaseTokenPermissions'
                    createdAt:
                      $ref: '#/components/schemas/DatabaseTokenCreatedAt'
                    expiresAt:
                      $ref: '#/components/schemas/DatabaseTokenExpiresAt'
                    revokedAt:
                      $ref: '#/components/schemas/DatabaseTokenRevokedAt'
                  required:
                    - id
                    - description
                    - permissions
                    - createdAt
                examples:
                  allFields:
                    summary: Update All Fields
                    value:
                      id: 55555555-5555-4555-8555-555555555555
                      description: Updated Limited Access Token
                      permissions:
                        - action: write
                          resource: DatabaseOne
                        - action: read
                          resource: DatabaseTwo
                        - action: write
                          resource: DatabaseThree
                      createdAt: '2023-12-21T17:32:28.000Z'
                  descriptionOnly:
                    summary: Update Description Only
                    value:
                      id: 55555555-5555-4555-8555-555555555555
                      description: Updated Limited Access Token
                      permissions:
                        - action: read
                          resource: DatabaseOne
                        - action: write
                          resource: DatabaseTwo
                      createdAt: '2023-12-21T17:32:28.000Z'
                  permissionsOnly:
                    summary: Update Permissions Only
                    value:
                      id: 55555555-5555-4555-8555-555555555555
                      description: Limited Access Token
                      permissions:
                        - action: write
                          resource: DatabaseOne
                        - action: read
                          resource: DatabaseTwo
                        - action: write
                          resource: DatabaseThree
                      createdAt: '2023-12-21T17:32:28.000Z'
                  removeAllPermissions:
                    summary: Remove All Permissions
                    value:
                      id: 55555555-5555-4555-8555-555555555555
                      description: Limited Access Token
                      permissions: []
                      createdAt: '2023-12-21T17:32:28.000Z'
          '400':
            $ref: '#/components/responses/BadRequest'
          '401':
            $ref: '#/components/responses/Unauthorized'
          '403':
            $ref: '#/components/responses/Forbidden'
          '404':
            $ref: '#/components/responses/NotFound'
          '409':
            $ref: '#/components/responses/Conflict'
          '500':
            $ref: '#/components/responses/InternalServerError'
        x-codeSamples:
          - label: cURL
            lang: Shell
            source: |
              HOST="https://cluster-host.com"

              update_token () {
                local tokenId=$1
                local response=$( \
                  curl \
                    --location "$HOST/api/v0/tokens/$tokenId" \
                    --request PATCH \
                    --header "Accept: application/json" \
                    --header 'Content-Type: application/json' \
                    --header "Authorization: Bearer $MANAGEMENT_TOKEN" \
                    --data '{
                      "description": "Updated Limited Access Token",
                      "permissions": [
                        {
                          "action": "write",
                          "resource": "DatabaseOne"
                        },
                        {
                          "action": "read",
                          "resource": "DatabaseTwo"
                        },
                        {
                          "action": "write",
                          "resource": "DatabaseThree"
                        }
                      ]
                    }' \
                )
                echo "$response"
              }
      delete:
        operationId: DeleteDatabaseToken
        summary: Delete a database token
        tags:
          - Database tokens
        parameters:
          - name: tokenId
            in: path
            description: The ID of the [database token](/influxdb3/clustered/admin/tokens/database/) to delete
            required: true
            schema:
              $ref: '#/components/schemas/UuidV4'
        responses:
          '204':
            description: The database token was successfully deleted
            $ref: '#/components/responses/NoContent'
          '400':
            $ref: '#/components/responses/BadRequest'
          '401':
            $ref: '#/components/responses/Unauthorized'
          '403':
            $ref: '#/components/responses/Forbidden'
          '404':
            $ref: '#/components/responses/NotFound'
          '500':
            $ref: '#/components/responses/InternalServerError'
        x-codeSamples:
          - label: cURL
            lang: Shell
            source: |
              HOST="https://cluster-host.com"

              delete_token () {
                local tokenId=$1
                local response=$( \
                  curl \
                    --location "$HOST/api/v0/tokens/$tokenId" \
                    --request DELETE \
                    --header "Accept: application/json" \
                    --header "Authorization: Bearer $MANAGEMENT_TOKEN" \
                )
                echo "$response"
              }
