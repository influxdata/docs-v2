{{/*
  RapiDoc Path - Multi-Method Path Renderer

  Renders all HTTP methods for an API path using RapiDoc.
  Uses match-type="includes" for path-based filtering.

  Required page params:
  - specFile: Path to the path-specific OpenAPI spec
  - apiPath: The API path to filter by (e.g., "/api/v3/configure/token/admin")
*/}}

{{ $specPath := .Params.specFile }}
{{ $apiPath := .Params.apiPath | default "" }}

{{/* Machine-readable links for AI agent discovery */}}
{{ if $specPath }}
{{ $specPathJSON := replace $specPath ".yaml" ".json" | replace ".yml" ".json" }}
<link rel="alternate" type="application/x-yaml" href="{{ $specPath | absURL }}" title="OpenAPI Specification (YAML)" />
<link rel="alternate" type="application/json" href="{{ $specPathJSON | absURL }}" title="OpenAPI Specification (JSON)" />
{{ end }}

{{/* Auth credentials modal */}}
<div class="api-auth-backdrop" hidden></div>
<div class="api-auth-popover" role="dialog" aria-label="API credentials" hidden>
  {{/* Content rendered by TypeScript component */}}
</div>

{{/*
  Determine supported auth schemes based on API path:
  - /api/v3/* endpoints: BearerAuthentication only
  - /api/v2/* endpoints: BearerAuthentication + TokenAuthentication
  - /write, /query (v1): All 4 schemes (Bearer, Token, Basic, Querystring)
*/}}
{{ $authSchemes := "bearer" }}
{{ if hasPrefix $apiPath "/api/v3" }}
  {{ $authSchemes = "bearer" }}
{{ else if hasPrefix $apiPath "/api/v2" }}
  {{ $authSchemes = "bearer,token" }}
{{ else if or (eq $apiPath "/write") (eq $apiPath "/query") }}
  {{ $authSchemes = "bearer,token,basic,querystring" }}
{{ end }}

{{/* Authentication info banner with trigger for credentials modal */}}
<div class="api-auth-info"
     data-component="api-auth-input"
     data-schemes="{{ $authSchemes }}">
  <svg class="api-auth-icon" viewBox="0 0 24 24" width="16" height="16" fill="currentColor">
    <path d="M18 8h-1V6c0-2.76-2.24-5-5-5S7 3.24 7 6v2H6c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V10c0-1.1-.9-2-2-2zm-6 9c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2zm3.1-9H8.9V6c0-1.71 1.39-3.1 3.1-3.1 1.71 0 3.1 1.39 3.1 3.1v2z"/>
  </svg>
  <span class="api-auth-status">This endpoint requires authentication.</span>
  <button type="button" class="api-auth-trigger">Set credentials</button>
</div>

{{/* RapiDoc component - uses path filtering with match-type="includes" */}}
<div class="api-reference-wrapper api-reference-path"
     data-component="rapidoc-mini"
     data-spec-url="{{ $specPath }}"
     data-match-paths="{{ $apiPath }}"
     data-match-type="includes">
  {{/* RapiDoc element created by TypeScript component */}}
</div>
